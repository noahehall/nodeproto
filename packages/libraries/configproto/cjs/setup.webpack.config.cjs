"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;

exports.__esModule = true;
exports.default = setupWebpack;

var _module = require("module");

var _fs = require("fs");

var _os = _interopRequireDefault(require("os"));

var _path = _interopRequireDefault(require("path"));

const throwMsg = (msg, prefix = 'error in setup.webpack.config: ') => {
  throw new Error(`${prefix}${msg}`);
};

const createCacheGroups = vendors => ({
  babel: { ...vendors,
    idHint: '3',
    priority: -8,
    test: /[\\/]node_modules[\\/].*babel.*[\\/]/
  },
  default: {
    idHint: '6',
    minChunks: 2,
    priority: -20,
    reuseExistingChunk: true
  },
  etc: { ...vendors,
    idHint: '5',
    priority: -10,
    test: /[\\/]node_modules[\\/]/
  },
  react: { ...vendors,
    idHint: '4',
    priority: -9,
    test: /[\\/]node_modules[\\/].*react.*[\\/]/
  },
  styled: { ...vendors,
    idHint: '1',
    priority: -6,
    test: /[\\/]node_modules[\\/](animate|normalize|styled|milligram).*[\\/]/
  },
  support: { ...vendors,
    idHint: '2',
    priority: -7,
    test: /[\\/]node_modules[\\/](reakit|react-aria|@reach).*[\\/]/
  }
});

function setupWebpack({
  context = process.cwd(),
  IS_DEV = false,
  IS_PROD = false,
  NODE_ENV = 'development',
  PATH_DIST = '',
  PATH_SRC = '',
  pkgJsonPath = './package.json',
  ...overrides
} = {}) {
  const r = (f = throwMsg('cant find file', 'error in webpack/setup.webpack.config.mjs.r: '), c = context) => _path.default.resolve(c, f);

  const getFile = (f = throwMsg('pathOnDisk', 'error in webpack/setup.webpack.config.mjs.getFile: ')) => (0, _fs.readFileSync)(r(f, context), 'utf8');

  const pkgJson = JSON.parse(getFile(pkgJsonPath));
  const pathDist = r(PATH_DIST || pkgJson.config.PATH_DIST);
  const pathSrc = r(PATH_SRC || pkgJson.config.PATH_SRC);
  const mode = NODE_ENV || pkgJson.config.NODE_ENV;
  const ifProd = IS_PROD || mode === 'production';
  const ifDev = IS_DEV || !ifProd;
  const terserPlugin = [() => ({
    extractComments: false,
    include: [pathDist],
    parallel: _os.default.cpus().length - 1 || 1,
    terserOptions: {
      format: {
        comments: false
      },
      keep_classnames: true,
      mangle: ifProd,
      module: false,
      toplevel: false
    },
    test: /\.(m|c)+js$/i
  })];
  const minSize = 20000;
  const maxSize = minSize * 6;
  const vendors = {
    chunks: 'all',
    enforce: true,
    filename: 'js/[name]/bundle.js',
    reuseExistingChunk: true
  };
  const splitChunks = {
    cacheGroups: createCacheGroups(vendors),
    chunks: 'all',
    enforceSizeThreshold: 50000,
    maxAsyncRequests: 30,
    maxAsyncSize: maxSize,
    maxInitialRequests: 30,
    maxInitialSize: maxSize,
    maxSize,
    minChunks: 1,
    minRemainingSize: minSize,
    minSize,
    name: false,
    usedExports: true
  };
  const optimization = {
    chunkIds: ifProd ? 'deterministic' : 'named',
    concatenateModules: true,
    emitOnErrors: true,
    flagIncludedChunks: true,
    innerGraph: true,
    mangleExports: ifProd,
    mergeDuplicateChunks: true,
    minimize: ifProd,
    minimizer: ifProd ? terserPlugin : undefined,
    moduleIds: ifProd ? 'deterministic' : 'named',
    nodeEnv: mode,
    portableRecords: true,
    providedExports: true,
    realContentHash: ifProd,
    removeAvailableModules: true,
    removeEmptyChunks: true,
    runtimeChunk: {
      name: 'runtime'
    },
    sideEffects: true,
    splitChunks,
    usedExports: true
  };
  return {
    config: {
      context,
      mode,
      optimization,
      ...overrides
    },
    pack: {
      builtinModules: _module.builtinModules,
      getFile,
      ifDev,
      ifProd,
      pathDist,
      pathSrc,
      pkgJson,
      resolve: r
    }
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3dlYnBhY2svc2V0dXAud2VicGFjay5jb25maWcubWpzIl0sIm5hbWVzIjpbInRocm93TXNnIiwibXNnIiwicHJlZml4IiwiRXJyb3IiLCJjcmVhdGVDYWNoZUdyb3VwcyIsInZlbmRvcnMiLCJiYWJlbCIsImlkSGludCIsInByaW9yaXR5IiwidGVzdCIsImRlZmF1bHQiLCJtaW5DaHVua3MiLCJyZXVzZUV4aXN0aW5nQ2h1bmsiLCJldGMiLCJyZWFjdCIsInN0eWxlZCIsInN1cHBvcnQiLCJzZXR1cFdlYnBhY2siLCJjb250ZXh0IiwicHJvY2VzcyIsImN3ZCIsIklTX0RFViIsIklTX1BST0QiLCJOT0RFX0VOViIsIlBBVEhfRElTVCIsIlBBVEhfU1JDIiwicGtnSnNvblBhdGgiLCJvdmVycmlkZXMiLCJyIiwiZiIsImMiLCJwYXRoIiwicmVzb2x2ZSIsImdldEZpbGUiLCJwa2dKc29uIiwiSlNPTiIsInBhcnNlIiwicGF0aERpc3QiLCJjb25maWciLCJwYXRoU3JjIiwibW9kZSIsImlmUHJvZCIsImlmRGV2IiwidGVyc2VyUGx1Z2luIiwiZXh0cmFjdENvbW1lbnRzIiwiaW5jbHVkZSIsInBhcmFsbGVsIiwib3MiLCJjcHVzIiwibGVuZ3RoIiwidGVyc2VyT3B0aW9ucyIsImZvcm1hdCIsImNvbW1lbnRzIiwia2VlcF9jbGFzc25hbWVzIiwibWFuZ2xlIiwibW9kdWxlIiwidG9wbGV2ZWwiLCJtaW5TaXplIiwibWF4U2l6ZSIsImNodW5rcyIsImVuZm9yY2UiLCJmaWxlbmFtZSIsInNwbGl0Q2h1bmtzIiwiY2FjaGVHcm91cHMiLCJlbmZvcmNlU2l6ZVRocmVzaG9sZCIsIm1heEFzeW5jUmVxdWVzdHMiLCJtYXhBc3luY1NpemUiLCJtYXhJbml0aWFsUmVxdWVzdHMiLCJtYXhJbml0aWFsU2l6ZSIsIm1pblJlbWFpbmluZ1NpemUiLCJuYW1lIiwidXNlZEV4cG9ydHMiLCJvcHRpbWl6YXRpb24iLCJjaHVua0lkcyIsImNvbmNhdGVuYXRlTW9kdWxlcyIsImVtaXRPbkVycm9ycyIsImZsYWdJbmNsdWRlZENodW5rcyIsImlubmVyR3JhcGgiLCJtYW5nbGVFeHBvcnRzIiwibWVyZ2VEdXBsaWNhdGVDaHVua3MiLCJtaW5pbWl6ZSIsIm1pbmltaXplciIsInVuZGVmaW5lZCIsIm1vZHVsZUlkcyIsIm5vZGVFbnYiLCJwb3J0YWJsZVJlY29yZHMiLCJwcm92aWRlZEV4cG9ydHMiLCJyZWFsQ29udGVudEhhc2giLCJyZW1vdmVBdmFpbGFibGVNb2R1bGVzIiwicmVtb3ZlRW1wdHlDaHVua3MiLCJydW50aW1lQ2h1bmsiLCJzaWRlRWZmZWN0cyIsInBhY2siLCJidWlsdGluTW9kdWxlcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQU1BOztBQUNBOztBQUVBOztBQUNBOztBQUdBLE1BQU1BLFFBQVEsR0FBRyxDQUNmQyxHQURlLEVBRWZDLE1BQU0sR0FBRyxpQ0FGTSxLQUdaO0FBQUUsUUFBTSxJQUFJQyxLQUFKLENBQVcsR0FBRUQsTUFBTyxHQUFFRCxHQUFJLEVBQTFCLENBQU47QUFBcUMsQ0FINUM7O0FBS0EsTUFBTUcsaUJBQWlCLEdBQUdDLE9BQU8sS0FBSztBQUNwQ0MsRUFBQUEsS0FBSyxFQUFFLEVBQ0wsR0FBR0QsT0FERTtBQUVMRSxJQUFBQSxNQUFNLEVBQUUsR0FGSDtBQUdMQyxJQUFBQSxRQUFRLEVBQUUsQ0FBQyxDQUhOO0FBSUxDLElBQUFBLElBQUksRUFBRTtBQUpELEdBRDZCO0FBT3BDQyxFQUFBQSxPQUFPLEVBQUU7QUFDUEgsSUFBQUEsTUFBTSxFQUFFLEdBREQ7QUFFUEksSUFBQUEsU0FBUyxFQUFFLENBRko7QUFHUEgsSUFBQUEsUUFBUSxFQUFFLENBQUMsRUFISjtBQUlQSSxJQUFBQSxrQkFBa0IsRUFBRTtBQUpiLEdBUDJCO0FBYXBDQyxFQUFBQSxHQUFHLEVBQUUsRUFDSCxHQUFHUixPQURBO0FBRUhFLElBQUFBLE1BQU0sRUFBRSxHQUZMO0FBR0hDLElBQUFBLFFBQVEsRUFBRSxDQUFDLEVBSFI7QUFJSEMsSUFBQUEsSUFBSSxF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QU0sR0FBR0UsWUFBSCxHQUFrQnVDLFNBVGhCO0FBVW5CQyxJQUFBQSxTQUFTLEVBQUUxQyxNQUFNLEdBQUcsZUFBSCxHQUFxQixPQVZuQjtBQVduQjJDLElBQUFBLE9BQU8sRUFBRTVDLElBWFU7QUFZbkI2QyxJQUFBQSxlQUFlLEVBQUUsSUFaRTtBQWFuQkMsSUFBQUEsZUFBZSxFQUFFLElBYkU7QUFjbkJDLElBQUFBLGVBQWUsRUFBRTlDLE1BZEU7QUFlbkIrQyxJQUFBQSxzQkFBc0IsRUFBRSxJQWZMO0FBZ0JuQkMsSUFBQUEsaUJBQWlCLEVBQUUsSUFoQkE7QUFpQm5CQyxJQUFBQSxZQUFZLEVBQUU7QUFBRXBCLE1BQUFBLElBQUksRUFBRTtBQUFSLEtBakJLO0FBa0JuQnFCLElBQUFBLFdBQVcsRUFBRSxJQWxCTTtBQW1CbkI3QixJQUFBQSxXQW5CbUI7QUFvQm5CUyxJQUFBQSxXQUFXLEVBQUU7QUFwQk0sR0FBckI7QUF1QkEsU0FBTztBQUNMakMsSUFBQUEsTUFBTSxFQUFFO0FBQ05wQixNQUFBQSxPQURNO0FBRU5zQixNQUFBQSxJQUZNO0FBR05nQyxNQUFBQSxZQUhNO0FBSU4sU0FBRzdDO0FBSkcsS0FESDtBQVFMaUUsSUFBQUEsSUFBSSxFQUFFO0FBQ0pDLE1BQUFBLGNBQWMsRUFBZEEsc0JBREk7QUFFSjVELE1BQUFBLE9BRkk7QUFHSlMsTUFBQUEsS0FISTtBQUlKRCxNQUFBQSxNQUpJO0FBS0pKLE1BQUFBLFFBTEk7QUFNSkUsTUFBQUEsT0FOSTtBQU9KTCxNQUFBQSxPQVBJO0FBUUpGLE1BQUFBLE9BQU8sRUFBRUo7QUFSTDtBQVJELEdBQVA7QUFvQkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAgKiBAbm9kZXByb3RvL2NvbmZpZ3Byb3RvIHNldHVwIHdlYnBhY2sgY29uZmlnXG4gICogZ2VuZXJhdGVzIGRhdGEgJiBmbnMgc3VpdGFibGUgZm9yIGdlbmVyYXRpbmcgYSB3ZWJwYWNrIGNvbmZpZ1xuICAqIGdlbmVyYWxseSB5b3Ugd2FudCB0byBzZW5kIHRoaXMgaW50byBiYXNlLndlYnBhY2suY29uZmlnLm1qc1xuICAqL1xuXG5pbXBvcnQgeyBidWlsdGluTW9kdWxlcyB9IGZyb20gJ21vZHVsZSc7XG5pbXBvcnQgeyByZWFkRmlsZVN5bmMgfSBmcm9tICdmcyc7XG5cbmltcG9ydCBvcyBmcm9tICdvcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuXG5jb25zdCB0aHJvd01zZyA9IChcbiAgbXNnLFxuICBwcmVmaXggPSAnZXJyb3IgaW4gc2V0dXAud2VicGFjay5jb25maWc6ICdcbikgPT4geyB0aHJvdyBuZXcgRXJyb3IoYCR7cHJlZml4fSR7bXNnfWApOyB9O1xuXG5jb25zdCBjcmVhdGVDYWNoZUdyb3VwcyA9IHZlbmRvcnMgPT4gKHtcbiAgYmFiZWw6IHtcbiAgICAuLi52ZW5kb3JzLFxuICAgIGlkSGludDogJzMnLFxuICAgIHByaW9yaXR5OiAtOCxcbiAgICB0ZXN0OiAvW1xcXFwvXW5vZGVfbW9kdWxlc1tcXFxcL10uKmJhYmVsLipbXFxcXC9dLyxcbiAgfSxcbiAgZGVmYXVsdDoge1xuICAgIGlkSGludDogJzYnLFxuICAgIG1pbkNodW5rczogMixcbiAgICBwcmlvcml0eTogLTIwLFxuICAgIHJldXNlRXhpc3RpbmdDaHVuazogdHJ1ZSxcbiAgfSxcbiAgZXRjOiB7XG4gICAgLi4udmVuZG9ycyxcbiAgICBpZEhpbnQ6ICc1JyxcbiAgICBwcmlvcml0eTogLTEwLFxuICAgIHRlc3Q6IC9bXFxcXC9dbm9kZV9tb2R1bGVzW1xcXFwvXS8sXG4gIH0sXG4gIHJlYWN0OiB7XG4gICAgLi4udmVuZG9ycyxcbiAgICBpZEhpbnQ6ICc0JyxcbiAgICBwcmlvcml0eTogLTksXG4gICAgdGVzdDogL1tcXFxcL11ub2RlX21vZHVsZXNbXFxcXC9dLipyZWFjdC4qW1xcXFwvXS8sXG4gIH0sXG4gIHN0eWxlZDoge1xuICAgIC4uLnZlbmRvcnMsXG4gICAgaWRIaW50OiAnMScsXG4gICAgcHJpb3JpdHk6IC02LFxuICAgIHRlc3Q6IC9bXFxcXC9dbm9kZV9tb2R1bGVzW1xcXFwvXShhbmltYXRlfG5vcm1hbGl6ZXxzdHlsZWR8bWlsbGlncmFtKS4qW1xcXFwvXS8sXG4gIH0sXG4gIHN1cHBvcnQ6IHtcbiAgICAuLi52ZW5kb3JzLFxuICAgIGlkSGludDogJzInLFxuICAgIHByaW9yaXR5OiAtNyxcbiAgICB0ZXN0OiAvW1xcXFwvXW5vZGVfbW9kdWxlc1tcXFxcL10ocmVha2l0fHJlYWN0LWFyaWF8QHJlYWNoKS4qW1xcXFwvXS8sXG4gIH0sXG59KTtcblxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBzZXR1cFdlYnBhY2soe1xuICBjb250ZXh0ID0gcHJvY2Vzcy5jd2QoKSxcbiAgSVNfREVWID0gZmFsc2UsXG4gIElTX1BST0QgPSBmYWxzZSxcbiAgTk9ERV9FTlYgPSAnZGV2ZWxvcG1lbnQnLFxuICBQQVRIX0RJU1QgPSAnJyxcbiAgUEFUSF9TUkMgPSAnJyxcbiAgcGtnSnNvblBhdGggPSAnLi9wYWNrYWdlLmpzb24nLFxuXG4gIC4uLm92ZXJyaWRlc1xufSA9IHt9KSB7XG4gIGNvbnN0IHIgPSAoZiA9IHRocm93TXNnKCdjYW50IGZpbmQgZmlsZScsICdlcnJvciBpbiB3ZWJwYWNrL3NldHVwLndlYnBhY2suY29uZmlnLm1qcy5yOiAnKSwgYyA9IGNvbnRleHQpID0+IHBhdGgucmVzb2x2ZShjLCBmKTtcblxuICBjb25zdCBnZXRGaWxlID0gKFxuICAgIGYgPSB0aHJvd01zZygncGF0aE9uRGlzaycsICdlcnJvciBpbiB3ZWJwYWNrL3NldHVwLndlYnBhY2suY29uZmlnLm1qcy5nZXRGaWxlOiAnKSxcbiAgKSA9PiByZWFkRmlsZVN5bmMocihmLCBjb250ZXh0KSwgJ3V0ZjgnKTtcblxuICBjb25zdCBwa2dKc29uID0gSlNPTi5wYXJzZShnZXRGaWxlKHBrZ0pzb25QYXRoKSk7XG4gIGNvbnN0IHBhdGhEaXN0ID0gcihQQVRIX0RJU1QgfHwgcGtnSnNvbi5jb25maWcuUEFUSF9ESVNUKTtcbiAgY29uc3QgcGF0aFNyYyA9IHIoUEFUSF9TUkMgfHwgcGtnSnNvbi5jb25maWcuUEFUSF9TUkMpO1xuICBjb25zdCBtb2RlID0gTk9ERV9FTlYgfHwgcGtnSnNvbi5jb25maWcuTk9ERV9FTlY7XG4gIGNvbnN0IGlmUHJvZCA9IElTX1BST0QgfHwgbW9kZSA9PT0gJ3Byb2R1Y3Rpb24nO1xuICBjb25zdCBpZkRldiA9IElTX0RFViB8fCAhaWZQcm9kO1xuXG4gIC8vIEBzZWUgaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNjYzNDM2MDIvdXNlLWxhdGVzdC10ZXJzZXItd2VicGFjay1wbHVnaW4td2l0aC13ZWJwYWNrNVxuICBjb25zdCB0ZXJzZXJQbHVnaW4gPSBbXG4gICAgKCkgPT4gKHtcbiAgICAgIGV4dHJhY3RDb21tZW50czogZmFsc2UsXG4gICAgICBpbmNsdWRlOiBbcGF0aERpc3RdLFxuICAgICAgcGFyYWxsZWw6IChvcy5jcHVzKCkubGVuZ3RoIC0gMSkgfHwgMSxcbiAgICAgIC8vIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3RlcnNlci90ZXJzZXIjbWluaWZ5LW9wdGlvbnNcbiAgICAgIHRlcnNlck9wdGlvbnM6IHtcbiAgICAgICAgZm9ybWF0OiB7IGNvbW1lbnRzOiBmYWxzZSB9LFxuICAgICAgICBrZWVwX2NsYXNzbmFtZXM6IHRydWUsXG4gICAgICAgIG1hbmdsZTogaWZQcm9kLFxuICAgICAgICBtb2R1bGU6IGZhbHNlLCAvLyBUT0RPOiB3aGVuIGVuYWJsaW5nIG1vZHVsZSArIG5vbW9kdWxlIG91dHB1dFxuICAgICAgICB0b3BsZXZlbDogZmFsc2UsXG4gICAgICB9LFxuICAgICAgdGVzdDogL1xcLihtfGMpK2pzJC9pLFxuICAgIH0pXG4gIF07XG5cbiAgY29uc3QgbWluU2l6ZSA9IDIwMDAwO1xuICBjb25zdCBtYXhTaXplID0gbWluU2l6ZSAqIDY7XG4gIGNvbnN0IHZlbmRvcnMgPSB7XG4gICAgY2h1bmtzOiAnYWxsJyxcbiAgICBlbmZvcmNlOiB0cnVlLFxuICAgIGZpbGVuYW1lOiAnanMvW25hbWVdL2J1bmRsZS5qcycsXG4gICAgcmV1c2VFeGlzdGluZ0NodW5rOiB0cnVlLFxuICB9O1xuXG4gIGNvbnN0IHNwbGl0Q2h1bmtzID0ge1xuICAgIGNhY2hlR3JvdXBzOiBjcmVhdGVDYWNoZUdyb3Vwcyh2ZW5kb3JzKSxcbiAgICBjaHVua3M6ICdhbGwnLFxuICAgIGVuZm9yY2VTaXplVGhyZXNob2xkOiA1MDAwMCxcbiAgICBtYXhBc3luY1JlcXVlc3RzOiAzMCxcbiAgICBtYXhBc3luY1NpemU6IG1heFNpemUsXG4gICAgbWF4SW5pdGlhbFJlcXVlc3RzOiAzMCxcbiAgICBtYXhJbml0aWFsU2l6ZTogbWF4U2l6ZSxcbiAgICBtYXhTaXplLFxuICAgIG1pbkNodW5rczogMSxcbiAgICBtaW5SZW1haW5pbmdTaXplOiBtaW5TaXplLCAvLyB0byBtaXJyb3IgcHJvZFxuICAgIG1pblNpemUsXG4gICAgbmFtZTogZmFsc2UsXG4gICAgdXNlZEV4cG9ydHM6IHRydWUsXG4gIH07XG5cbiAgLy8gc2xvd3MgZG93biBkZXYgYSBiaXQsIGJ1dCBhdCBsZWFzdCBpdCBBTE1PU1QgbWlycm9ycyBwcm9kXG4vLyBAc2VlIGh0dHBzOi8vd2VicGFjay5qcy5vcmcvY29uZmlndXJhdGlvbi9vcHRpbWl6YXRpb24vXG4gIGNvbnN0IG9wdGltaXphdGlvbiA9IHtcbiAgICBjaHVua0lkczogaWZQcm9kID8gJ2RldGVybWluaXN0aWMnIDogJ25hbWVkJyxcbiAgICBjb25jYXRlbmF0ZU1vZHVsZXM6IHRydWUsXG4gICAgZW1pdE9uRXJyb3JzOiB0cnVlLCAvLyB1c2VmdWwgaWYgd2UgbmVlZCB0byBkZWJ1Z1xuICAgIGZsYWdJbmNsdWRlZENodW5rczogdHJ1ZSxcbiAgICBpbm5lckdyYXBoOiB0cnVlLFxuICAgIG1hbmdsZUV4cG9ydHM6IGlmUHJvZCxcbiAgICBtZXJnZUR1cGxpY2F0ZUNodW5rczogdHJ1ZSxcbiAgICBtaW5pbWl6ZTogaWZQcm9kLFxuICAgIG1pbmltaXplcjogaWZQcm9kID8gdGVyc2VyUGx1Z2luIDogdW5kZWZpbmVkLFxuICAgIG1vZHVsZUlkczogaWZQcm9kID8gJ2RldGVybWluaXN0aWMnIDogJ25hbWVkJyxcbiAgICBub2RlRW52OiBtb2RlLFxuICAgIHBvcnRhYmxlUmVjb3JkczogdHJ1ZSxcbiAgICBwcm92aWRlZEV4cG9ydHM6IHRydWUsXG4gICAgcmVhbENvbnRlbnRIYXNoOiBpZlByb2QsXG4gICAgcmVtb3ZlQXZhaWxhYmxlTW9kdWxlczogdHJ1ZSxcbiAgICByZW1vdmVFbXB0eUNodW5rczogdHJ1ZSxcbiAgICBydW50aW1lQ2h1bms6IHsgbmFtZTogJ3J1bnRpbWUnIH0sXG4gICAgc2lkZUVmZmVjdHM6IHRydWUsXG4gICAgc3BsaXRDaHVua3MsXG4gICAgdXNlZEV4cG9ydHM6IHRydWUsXG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBjb25maWc6IHtcbiAgICAgIGNvbnRleHQsXG4gICAgICBtb2RlLFxuICAgICAgb3B0aW1pemF0aW9uLFxuICAgICAgLi4ub3ZlcnJpZGVzXG4gICAgfSxcblxuICAgIHBhY2s6IHtcbiAgICAgIGJ1aWx0aW5Nb2R1bGVzLFxuICAgICAgZ2V0RmlsZSxcbiAgICAgIGlmRGV2LFxuICAgICAgaWZQcm9kLFxuICAgICAgcGF0aERpc3QsXG4gICAgICBwYXRoU3JjLFxuICAgICAgcGtnSnNvbixcbiAgICAgIHJlc29sdmU6IHIsXG4gICAgfSxcblxuICB9O1xufVxuIl19