"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;

exports.__esModule = true;
exports.default = webpackBuild;

var _testCompiler = _interopRequireDefault(require("./test.compiler.mjs"));

var _webpack = _interopRequireDefault(require("webpack"));

const handleConfigErrors = ({
  stack = 'stack undefined',
  details = 'details undefined',
  ...err
}) => console.error({
  err,
  stack,
  details
});

const statsOptions = {
  maxModules: Infinity,
  optimizationBailout: true,
  errorDetails: true
};

const handleCompileIssues = stats => {
  if (stats.hasErrors() || stats.hasWarnings()) {
    const {
      errors,
      warnings
    } = stats.toJson();
    console.error({
      errors,
      warnings
    });
    if (errors.length) throw new Error('errors exist');
  }

  console.info(stats.toString({ ...statsOptions,
    chunks: false,
    colors: true
  }));
};

const compilerCallback = (err, stats) => {
  if (err) return handleConfigErrors(err);
  handleCompileIssues(stats);
};

function webpackBuild(useConfig = 'THROW IF MISSING', toDisk = true) {
  return toDisk ? (0, _webpack.default)(useConfig, compilerCallback) : (0, _testCompiler.default)(useConfig);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3dlYnBhY2svYnVpbGQud2VicGFjay5jb25maWcubWpzIl0sIm5hbWVzIjpbImhhbmRsZUNvbmZpZ0Vycm9ycyIsInN0YWNrIiwiZGV0YWlscyIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsInN0YXRzT3B0aW9ucyIsIm1heE1vZHVsZXMiLCJJbmZpbml0eSIsIm9wdGltaXphdGlvbkJhaWxvdXQiLCJlcnJvckRldGFpbHMiLCJoYW5kbGVDb21waWxlSXNzdWVzIiwic3RhdHMiLCJoYXNFcnJvcnMiLCJoYXNXYXJuaW5ncyIsImVycm9ycyIsIndhcm5pbmdzIiwidG9Kc29uIiwibGVuZ3RoIiwiRXJyb3IiLCJpbmZvIiwidG9TdHJpbmciLCJjaHVua3MiLCJjb2xvcnMiLCJjb21waWxlckNhbGxiYWNrIiwid2VicGFja0J1aWxkIiwidXNlQ29uZmlnIiwidG9EaXNrIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBT0E7O0FBQ0E7O0FBRUEsTUFBTUEsa0JBQWtCLEdBQUcsQ0FBQztBQUMxQkMsRUFBQUEsS0FBSyxHQUFHLGlCQURrQjtBQUUxQkMsRUFBQUEsT0FBTyxHQUFHLG1CQUZnQjtBQUcxQixLQUFHQztBQUh1QixDQUFELEtBSXJCQyxPQUFPLENBQUNDLEtBQVIsQ0FBYztBQUFFRixFQUFBQSxHQUFGO0FBQU9GLEVBQUFBLEtBQVA7QUFBY0MsRUFBQUE7QUFBZCxDQUFkLENBSk47O0FBT0EsTUFBTUksWUFBWSxHQUFHO0FBQ25CQyxFQUFBQSxVQUFVLEVBQUVDLFFBRE87QUFFbkJDLEVBQUFBLG1CQUFtQixFQUFFLElBRkY7QUFHbkJDLEVBQUFBLFlBQVksRUFBRTtBQUhLLENBQXJCOztBQU1BLE1BQU1DLG1CQUFtQixHQUFJQyxLQUFELElBQVc7QUFDckMsTUFBSUEsS0FBSyxDQUFDQyxTQUFOLE1BQXFCRCxLQUFLLENBQUNFLFdBQU4sRUFBekIsRUFBOEM7QUFDNUMsVUFBTTtBQUFFQyxNQUFBQSxNQUFGO0FBQVVDLE1BQUFBO0FBQVYsUUFBcUNKLEtBQUssQ0FBQ0ssTUFBTixFQUEzQztBQUNBYixJQUFBQSxPQUFPLENBQUNDLEtBQVIsQ0FBYztBQUFFVSxNQUFBQSxNQUFGO0FBQVVDLE1BQUFBO0FBQVYsS0FBZDtBQUVBLFFBQUlELE1BQU0sQ0FBQ0csTUFBWCxFQUFtQixNQUFNLElBQUlDLEtBQUosQ0FBVSxjQUFWLENBQU47QUFDcEI7O0FBRURmLEVBQUFBLE9BQU8sQ0FBQ2dCLElBQVIsQ0FBYVIsS0FBSyxDQUFDUyxRQUFOLENBQWUsRUFBRSxHQUFHZixZQUFMO0FBQW1CZ0IsSUFBQUEsTUFBTSxFQUFFLEtBQTNCO0FBQWtDQyxJQUFBQSxNQUFNLEVBQUU7QUFBMUMsR0FBZixDQUFiO0FBQ0QsQ0FURDs7QUFXQSxNQUFNQyxnQkFBZ0IsR0FBRyxDQUFDckIsR0FBRCxFQUFNUyxLQUFOLEtBQWdCO0FBQ3ZDLE1BQUlULEdBQUosRUFBUyxPQUFPSCxrQkFBa0IsQ0FBQ0csR0FBRCxDQUF6QjtBQUNUUSxFQUFBQSxtQkFBbUIsQ0FBQ0MsS0FBRCxDQUFuQjtBQUNELENBSEQ7O0FBS2UsU0FBU2EsWUFBVCxDQUFzQkMsU0FBUyxHQUFHLGtCQUFsQyxFQUFzREMsTUFBTSxHQUFHLElBQS9ELEVBQXFFO0FBQ2xGLFNBQU9BLE1BQU0sR0FDVCxzQkFBUUQsU0FBUixFQUFtQkYsZ0JBQW5CLENBRFMsR0FFVCwyQkFBYUUsU0FBYixDQUZKO0FBR0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIGJ1aWxkIGFueSB3ZWJwYWNrIGNvbmZpZyBhbmQgb3V0cHV0IGl0cyBmaWxlcyB0byBkaXNrfG1lbWZzXG4gKi9cblxuLy8gaW1wb3J0IHdlYnBhY2tEZXZDb25maWcgZnJvbSAnLi93ZWJwYWNrLmRldi5jb25maWcubWpzJztcbi8vIGltcG9ydCB3ZWJwYWNrUHJvZENvbmZpZyBmcm9tICcuL3dlYnBhY2sucHJvZC5jb25maWcubWpzJztcblxuaW1wb3J0IHRlc3RDb21waWxlciBmcm9tICcuL3Rlc3QuY29tcGlsZXIubWpzJztcbmltcG9ydCB3ZWJwYWNrIGZyb20gJ3dlYnBhY2snO1xuXG5jb25zdCBoYW5kbGVDb25maWdFcnJvcnMgPSAoe1xuICBzdGFjayA9ICdzdGFjayB1bmRlZmluZWQnLFxuICBkZXRhaWxzID0gJ2RldGFpbHMgdW5kZWZpbmVkJyxcbiAgLi4uZXJyXG59KSA9PiBjb25zb2xlLmVycm9yKHsgZXJyLCBzdGFjaywgZGV0YWlscywgfSk7XG5cbi8vIEBzZWUgaHR0cHM6Ly93ZWJwYWNrLmpzLm9yZy9jb25maWd1cmF0aW9uL3N0YXRzL1xuY29uc3Qgc3RhdHNPcHRpb25zID0ge1xuICBtYXhNb2R1bGVzOiBJbmZpbml0eSxcbiAgb3B0aW1pemF0aW9uQmFpbG91dDogdHJ1ZSxcbiAgZXJyb3JEZXRhaWxzOiB0cnVlLFxufTtcblxuY29uc3QgaGFuZGxlQ29tcGlsZUlzc3VlcyA9IChzdGF0cykgPT4ge1xuICBpZiAoc3RhdHMuaGFzRXJyb3JzKCkgfHwgc3RhdHMuaGFzV2FybmluZ3MoKSkge1xuICAgIGNvbnN0IHsgZXJyb3JzLCB3YXJuaW5ncy8qLCAuLi5pbmZvICovIH0gPSBzdGF0cy50b0pzb24oKTtcbiAgICBjb25zb2xlLmVycm9yKHsgZXJyb3JzLCB3YXJuaW5ncyB9KTtcblxuICAgIGlmIChlcnJvcnMubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoJ2Vycm9ycyBleGlzdCcpO1xuICB9XG5cbiAgY29uc29sZS5pbmZvKHN0YXRzLnRvU3RyaW5nKHsgLi4uc3RhdHNPcHRpb25zLCBjaHVua3M6IGZhbHNlLCBjb2xvcnM6IHRydWUgfSkpO1xufTtcblxuY29uc3QgY29tcGlsZXJDYWxsYmFjayA9IChlcnIsIHN0YXRzKSA9PiB7XG4gIGlmIChlcnIpIHJldHVybiBoYW5kbGVDb25maWdFcnJvcnMoZXJyKTtcbiAgaGFuZGxlQ29tcGlsZUlzc3VlcyhzdGF0cyk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiB3ZWJwYWNrQnVpbGQodXNlQ29uZmlnID0gJ1RIUk9XIElGIE1JU1NJTkcnLCB0b0Rpc2sgPSB0cnVlKSB7XG4gIHJldHVybiB0b0Rpc2tcbiAgICA/IHdlYnBhY2sodXNlQ29uZmlnLCBjb21waWxlckNhbGxiYWNrKVxuICAgIDogdGVzdENvbXBpbGVyKHVzZUNvbmZpZyk7XG59XG4iXX0=