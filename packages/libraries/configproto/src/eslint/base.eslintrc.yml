# @nodeproto/configproto - base eslint config
# @see https://eslint.org/docs/user-guide/configuring/language-options
# @see https://json.schemastore.org/eslintrc.json
# @see https://github.com/amilajack/eslint-plugin-flowtype-errors/wiki/Advanced-Config
# @see https://github.com/amilajack/eslint-plugin-flowtype-errors/wiki/Advanced-Config

reportUnusedDisableDirectives: true
ignorePatterns: ['**/node_modules/**','**/dist/**', '**/flow-typed/**', '**/bundlestats/**', '**/copypasta/**'] # '**/node_modules/**', included by default

# @see https://github.com/babel/babel/tree/main/eslint/babel-eslint-parser
# @see https://github.com/babel/babel/blob/main/eslint/babel-eslint-config-internal/index.js
# dont use /experimental-worker like in ^
parser: "@babel/eslint-parser"
parserOptions:
  allowImportExportEverywhere: false
  ecmaVersion: 12 # dont fkn use "latest", it breaks eslint, @see https://github.com/eslint/eslint-scope/issues/55
  requireConfigFile: true # force a configFile so we dont have to always debug htis fkn issue (required for @babel/eslint-parser, else throws error)
  sourceType: module
  ecmaFeatures:
    globalReturn: true
    impliedStrict: true
    jsx: true
    modules: true
  # set babelOptions when extending if dont want to use a babel config/using webpack + babel-loader
  babelOptions:
    rootMode: upward-optional
    # configFile: you have to set this

# @see https://eslint.org/docs/user-guide/configuring/language-options#specifying-environments
env:
  es2021: true
  es6: true
  node: true
  shelljs: true


plugins:
  - "@babel"
  - flowtype-errors
  - "fb-flow"
  - html
  - markdown
  - node
  - promise
  - yml

extends:
  # general plugins up here
  - "eslint:recommended"
  - "plugin:node/recommended"
  - "plugin:promise/recommended"

  # priority plugins here
  - plugin:markdown/recommended
  - plugin:yml/standard
  - plugin:json/recommended-with-comments
  - plugin:flowtype-errors/recommended

settings:
  # @see https://github.com/BenoitZugmeyer/eslint-plugin-html
  # .erb, .handlebars, .hbs, .htm, .html, .mustache, .nunjucks, .php, .tag, .twig, .we
  html/html-extensions: [.html, .htm]
  html/xml-extensions: [.xhtml, .xml]
  html/indent: "+2"
  html/report-bad-indent: error

  flowtype-errors:
    stopOnExit: false

  # @see https://github.com/import-js/eslint-plugin-import#settings
  # parse these as modules and inspect them for exports
  # throws error if no export is found
  # import/extensions:
  # - .jsx
  # - .mjs
  # all dirs that contain monorepos packages
  # will be trated as external ones no matter which resolver is used
  # import/external-module-folders:
  #   - node_modules
  #   - packages/libraries
  #   - packages/apps
  #   - packages/tests
  #   - packages/tools


# todo
# @see https://eslint.org/docs/user-guide/configuring/language-options#specifying-environments
# globals:
# flow
# $Keys: true
# Iterator: true

# glob-based configuration
overrides:
  - files: ["**/*.cjs"]
    parserOptions:
      sourceType: script
  - files: ["**/*.yaml", "**/*.yml"]
    parser: yaml-eslint-parser
  # @see https://github.com/eslint/eslint-plugin-markdown
  - files: ["**/*.md"]
    processor: markdown/markdown
    rules:
      "@babel/no-unused-expressions": 0
      # import/no-unresolved: 0
      no-console: 0
      no-undef: 0
      no-unused-vars: 0
      padded-blocks: 0
      no-inline-html: 0
      # MD033/no-inline-html: 0 not sure which of these work, review markdownlint
      # MD033: 0

# any enabled @babel rule requires you to turn off the same eslint rule, e.g. see semi
rules:
  # great rules here
  "@babel/new-cap": error
  "@babel/no-invalid-this": error
  "@babel/no-unused-expressions": error
  "@babel/object-curly-spacing": [error, always]
  "@babel/semi": [error, always] # love ending semi - read this https://eslint.org/docs/rules/semi
  function-call-argument-newline: [error, consistent]
  no-multiple-empty-lines: error
  no-throw-literal: error
  no-undef: error
  no-unused-vars: off # broken with flowtype-errors?
  node/no-unpublished-require: warn
  padded-blocks: [error, never]
  prefer-named-capture-group: 0 # performance
  prefer-object-spread: error

  sort-imports:
    - error
    - ignoreCase: true
      ignoreDeclarationSort: false
      ignoreMemberSort: false
      allowSeparatedGroups: true
      memberSyntaxSortOrder: # supports sorting lines ascending
        - none # import 'poop'
        - multiple # import { p, o, o, p } # usually on more than one line so hard to sort in vscode
        - all # import * as poop
        - single # import poop 'from 'poop
  sort-keys:
    - error
    - asc
    - caseSensitive: false
      minKeys: 4
      natural: true

  max-lines-per-function:
    - error
    - skipBlankLines: true
      skipComments: true
      max: 120 # too many fkn functions is a code smell too
  no-console:
    - error # console.log
    - allow:
        - warn
        - error
        - info
        - table
        - assert

  # flow specific rules
  # flowtype-errors
  flowtype-errors/show-errors: error
  flowtype-errors/show-warnings: warn
  flowtype-errors/enforce-min-coverage:
    - error
    - 100

  # fb-flow
  fb-flow/use-indexed-access-type: error
  fb-flow/use-exact-by-default-object-type: error
  fb-flow/use-flow-enums: error
  fb-flow/flow-enums-default-if-possible: error
  fb-flow/no-flow-enums-object-mapping: error

    # markdownlint
  MD033/no-inline-html: off # no-markdown-in-html
  no-inline-html: off
  MD033: off
  # dumb fkn rules here
  arrow-parens: 0
  capitalized-comments: 0
  comma-dangle: 0 # love trailing commas
  id-length: 0
  line-comment-position: 0
  multiline-comment-style: 0
  no-inline-comments: 0
  no-ternary: 0
  semi: 0

  # doesnt seem to work right - but would be great if it did
  node/no-unpublished-import: 0
  node/no-missing-require: 0
  node/no-missing-import: 0
